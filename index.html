<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Free Tap Water Map</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-QVJH5E0obw1UJYF2Y9I9/9gfujExk6x0WqCg/n9C1Ko="
    crossorigin=""
  ></script>

  <script>
    // Inicializar el mapa
    const map = L.map('map').setView([52.37, 4.90], 8); // Por defecto centrado en Países Bajos

    // Cargar capa base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Cargar los datos desde GitHub Raw
    fetch('https://raw.githubusercontent.com/davidsuarez82/FreeTapWater/main/restaurants.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('Error al cargar JSON');
        }
        return response.json();
      })
      .then(data => {
        data.forEach(place => {
          let color;
          switch (place["Tap Water Policy"]) {
            case "No, they charge high price":
              color = "red";
              break;
            case "Yes, at reasonable cost":
              color = "orange";
              break;
            case "Yes, for free":
              color = "green";
              break;
            default:
              color = "gray";
          }

          const marker = L.circleMarker([place.Latitude, place.Longitude], {
            radius: 8,
            fillColor: color,
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          }).addTo(map);

          const popupContent = `<strong>${place["Restaurant Name"]}</strong><br/>
            ${place.Address}<br/>
            <em>${place["Tap Water Policy"]}</em><br/>
            <small>${place.Comments || ''}</small>`;

          marker.bindPopup(popupContent);
        });
      })
      .catch(error => {
        console.error('Error al cargar los datos del JSON:', error);
        alert("No se pudieron cargar los datos del mapa.");
      });
  </script>
</body>
</html>
